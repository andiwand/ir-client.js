var IR=IR||{};IR["interface"]=IR["interface"]||{},$.extend(IR["interface"],{discover:Util.notImplemented,send:Util.notImplemented,receive:Util.notImplemented,configure:Util.notImplemented,load:Util.notImplemented,save:Util.notImplemented});var IR=IR||{},IR=IR||{};IR.client=IR.client||{},$.extend(IR.remote,{"default":{error_settings:{frequency_error:new MarginOfError(.1,!1),time_error:new MarginOfError(.1,!1)}},"const":{error_frequency_key:"frequency_error",error_time_key:"time_error"}});var IR=IR||{};IR.Frame=function(){},IR.Frame.prototype.toString=function(){return JSON.stringify(this.serialize())},IR.Frame.prototype.getProtocol=Util.notImplemented,IR.Frame.prototype.getFrequency=function(){return this.getProtocol().frequency},IR.Frame.prototype.encode=function(a){return this.getProtocol().encode(this,a)},IR.Frame.prototype.decode=function(a,b){return this.getProtocol().decode(a,b)},IR.Frame.serialize=function(a){Exception.assert(a instanceof IR.Frame);var b={},c=a.getProtocol();return b.protocol=c.name,b.data=a.serialize(),b},IR.Frame.prototype.serialize=Util.notImplemented,IR.Frame.deserialize=function(a){var b=IR.Protocol.map[a.protocol],c=b.getFrameClass();return c.deserialize(a.data)};var IR=IR||{};IR.NecFrame=function(a){IR.Frame.call(this,IR.Frame),assert(isInt32(a)),this._data=a},IR.NecFrame.prototype=Object.create(IR.Frame.prototype),IR.NecFrame.prototype.constructor=IR.NecFrame,IR.NecFrame.prototype.getProtocol=Util.dynamicGet(IR,"NecProtocol"),IR.NecFrame.prototype.serialize=function(){return this._data},IR.NecFrame.deserialize=function(a){return new IR.NecFrame(a)};var IR=IR||{};IR.RawFrame=function(a,b){IR.Frame.call(this,IR.Frame),assert(isInt(a)),assert(isArray(b)),this._frequency=a,this._times=b},IR.RawFrame.prototype=Object.create(IR.Frame.prototype),IR.RawFrame.prototype.constructor=IR.RawFrame,IR.RawFrame.prototype.getProtocol=Util.dynamicGet(IR,"RawProtocol"),IR.RawFrame.prototype.getFrequency=function(){return this.frequency},IR.RawFrame.prototype.serialize=function(){var a={};return a.frequency=this._frequency,a.times=this._times,a},IR.RawFrame.deserialize=function(a){return new IR.RawFrame(a.frequency,a.times)};var IR=IR||{};IR.Protocol=function(a,b){Exception.assert(Object.isString(a)),Exception.assert(null===b||Object.isInt(b)),this.name=a,this.frequency=b,IR.Protocol.map[a]=this},IR.Protocol.map={},IR.Protocol.prototype.toString=function(){return this.name+" protocol"},IR.Protocol.prototype.getFrameClass=Util.notImplemented,IR.Protocol.prototype.encode=function(a,b){Exception.assert(a instanceof this.getFrameClass());var c=new IR.RawFrame(a.getFrequency(),[]),d=new IR.RawHelper(c,b);return this._encode(a,d,b),c},IR.Protocol.prototype._encode=Util.notImplemented,IR.Protocol.prototype.decode=function(a,b){Exception.assert(a instanceof IR.RawFrame);var c=new IR.RawHelper(a,b);return this._decode(c,b)},IR.Protocol.prototype._decode=Util.notImplemented;var IR=IR||{};IR.NecProtocol=new IR.Protocol("NEC",38222),$.extend(IR.NecProtocol,{_TIME_INIT_MARK:.009,_TIME_INIT_SPACE:.0045,_TIME_REPEAT_SPACE:.00225,_TIME_BIT_MARK:5625e-7,_TIME_ZERO_SPACE:5625e-7,_TIME_ONE_SPACE:.0016875,_TIME_END_MARK:5625e-7,_TIMES_DEFAULT:67,_TIMES_REPEAT:3,_BITS:32,_REPEAT:4294967295,getFrameClass:Util.dynamicGet(IR,"NecFrame"),_encode:function(a,b,c){if(b.write(this._TIME_INIT_MARK),nec._data===this._REPEAT)b.write(this._TIME_REPEAT_SPACE);else{b.write(this._TIME_INIT_SPACE);for(var d=0;d<this._BITS;d++)b.write(this._TIME_BIT_MARK),0!==(nec._data>>d&1)?b.write(this._TIME_ONE_SPACE):b.write(this._TIME_ZERO_SPACE)}b.write(this._TIME_END_MARK)},_decode:function(a,b){var c=0;if(!a.matchFrequency(this.frequency))return null;if(!a.matchTime(this._TIME_INIT_MARK))return null;if(a.matchTime(this._TIME_INIT_SPACE))for(var d=0;d<this._BITS;d++){if(!a.matchTime(this._TIME_BIT_MARK))return null;if(a.matchTime(this._TIME_ONE_SPACE))c|=1<<d;else if(!a.matchTime(this._TIME_ZERO_SPACE))return null}else{if(!a.matchTime(this._TIME_INIT_SPACE))return null;c=this._REPEAT}return a.matchTime(this._TIME_END_MARK)?a.position()!=a.size()?null:new IR.NecFrame(c):null}});var IR=IR||{};IR.RawProtocol=new IR.Protocol("RAW",null),$.extend(IR.RawProtocol,{getFrameClass:Util.dynamicGet(IR,"RawFrame"),encode:function(a,b){return a},decode:function(a,b){return a}});var IR=IR||{};IR.Station=function(a,b,c){Exception.assert(Object.isString(a)),Exception.assert(Object.isString(b)),Exception.assert(Object.isInt(c)),this.name=a,this._address=b,this._port=c},IR.Station.discover=function(a,b,c){Exception.assert(Object.isInt(a)),Exception.assert(Object.isInt(b)),Exception.assert(Object.isInt(c)),IR["interface"].discover(a,b,c)},IR.Station.prototype.send=function(a){Exception.assert(a instanceof IR.Frame),IR["interface"].send(this,a)},IR.Station.prototype.receive=function(){return IR["interface"].receive(this)},IR.Station.prototype.configure=function(a,b,c){Exception.assert(Object.isString(a)),Exception.assert(Object.isString(b)),Exception.assert(Object.isString(c)),IR["interface"].configure(this,a,b,c)},IR.Station.prototype.serialize=function(){var a={};return a.name=this.name,a.address=this._address,a.port=this._port,a},IR.Station.deserialize=function(a){return new IR.Station(a.name,a.address,a.port)};var IR=IR||{};IR.RawHelper=function(a,b){Exception.assert(a instanceof IR.RawFrame),Exception.assert(isObject(b)),this._raw=a,this._settings=b,this._pos=0},IR.RawHelper.prototype.size=function(){return this._raw._times.length},IR.RawHelper.prototype.position=function(a){return a?(Exception.assert(isInt(a)),void(this._pos=a)):this._pos},IR.RawHelper.prototype.write=function(a){this._raw._times[this._pos]=a,this._pos++},IR.RawHelper.prototype.matchFrequency=function(a){var b=this._settings[IR["const"].error_frequency_key];return b.check(this._raw._frequency,a)},IR.RawHelper.prototype.matchTime=function(a){var b=this._settings[IR["const"].error_time_key],c=this._raw._times[this._pos],d=b.check(c,a);return d&&this._pos++,d},IR.RawHelper.prototype.match=function(a){Exception.assert(Object.isArray(a));for(var b=0;b<a.length;b++)if(this.matchTime(a[b]))return b;return-1};var IR=IR||{};IR.remote=IR.remote||{},$.extend(IR.remote,{state:null,_ready:!1,_observers:[],init:function(){IR["interface"].load(IR.remote._loaded)},isReady:function(){return IR.remote._ready},_fire:function(){for(var a=0;a<IR.remote._observers.length;a++)IR.remote._observers[a]()},addObserver:function(a){IR.remote._ready&&a(),IR.remote._observers.push(a)},_verify:function(a){return!0},_load:function(a){var b={};$.extend(b,a),b.devices=[],IR.remote.state=b},_loaded:function(a){IR.remote._verify(a),IR.remote._load(a),IR.remote._ready=!0,IR.remote._fire()},save:function(){var a={};$.extend(a,IR.remote.state),delete a.devices,IR["interface"].save(a)}});